<mt:setvarblock name="page_title"><__trans phrase="Attach mail test"></mt:setvarblock>

<mt:setvarblock name="css_include" append="1">
    <style>
    .page_content .template {
        display:none;
    }
    </style>
</mt:setvarblock>

<mt:setvarblock name="page_content">
    <mt:if name="success">
    <mtapp:statusmsg
        id="success"
        class="success">
        <__trans phrase="An email has been sent.">
    </mtapp:statusmsg>
    </mt:if>
    <mt:if name="error">
    <mtapp:statusmsg
        id="generic-error"
        class="error"
        can_close="0">
        <__trans phrase="Failed to send an email. See the system log fo details.">
    </mtapp:statusmsg>
    </mt:if>

    <div class="page_content">

        <mtapp:form id="send" mode="attach_mail_test_send" enctype="multipart/form-data">

            <mtapp:setting
                id="to_address"
                label="<__trans phrase="To">"
                label_for="to_address"
                hint="<__trans phrase="Set one or more addresses separated by commas.">"
                show_hint="1">
                <input type="text" id="to_address" class="form-control text email required" name="to">
            </mtapp:setting>

            <mtapp:setting
                id="cc_address"
                label="<__trans phrase="Cc">"
                label_for="cc_address"
                hint="<__trans phrase="Set one or more addresses separated by commas.">"
                show_hint="1">
                <input type="text" id="cc_address" class="form-control text email" name="cc">
            </mtapp:setting>

            <mtapp:setting
                id="bcc_address"
                label="<__trans phrase="Bcc">"
                label_for="bcc_address"
                hint="<__trans phrase="Set one or more addresses separated by commas.">"
                show_hint="1">
                <input type="text" id="bcc_address" class="form-control text email" name="bcc">
            </mtapp:setting>

            <mtapp:setting
                id="subject"
                label="<__trans phrase="Subject">"
                label_for="subject">
                <input type="text" id="subject" class="form-control text required" name="subject">
            </mtapp:setting>

            <mtapp:setting
                id="body"
                label="<__trans phrase="Message body">">
                <textarea name="body" id="body" class="form-control text low"></textarea>
            </mt:app:setting>
            
            <div class="attachmentContainer">
            </div>

            <button class="btn btn-default action button add-file"><__trans phrase="Add MIME part by file"></button>
            <button class="btn btn-default action button add-text"><__trans phrase="Add MIME part by text"></button>

            <mt:setvarblock name="action_buttons">
            <button type="submit" class="btn btn-primary action primary button"><__trans phrase="Send"></button>
            </mt:setvarblock>
            <mt:include name="include/actions_bar.tmpl" bar_position="bottom" hide_pager="1" settings_bar="1" align_right="1">
        </mtapp:form>

        <div class="field field-content form-group field-left-label template template1">
            <label class="first-child"></label>
            <input type="file" class="form-control last-child">
            <label><__trans phrase="Filename"> (Optional): </label>
            <input type="text" class="form-control text name">
        </div>
        <div class="field field-content form-group field-left-label template template2">
            <label class="first-child"></label>
            <textarea class="form-control text low last-child"></textarea>
            <label><__trans phrase="Filename"> (Optional): </label>
            <input type="text" class="form-control text name">
        </div>

        <script>
            (function($){
                'use strict';
                var cont = $('.attachmentContainer');
                var tpl1 = $('.template1').clone().removeClass('template');
                var tpl2 = $('.template2').clone().removeClass('template');
                var clone = function(template, element){
                    var len = cont.children('div').length + 1;
                    var part = template.clone();
                    part.find('label:nth-child(1)').html('attachment' + len).attr('for', 'attach' + len);
                    part.find(element).attr('id', 'attach' + len);
                    part.find(element).attr('name', 'attach' + len);
                    part.find('.name').attr('name', 'attach' + len + '-name');
                    cont.append(part);
                    return part;
                };
                $('.add-file').on('click', function() {
                    var part = clone(tpl1, 'input');
                    return false;
                });
                $('.add-text').on('click', function() {
                    var part = clone(tpl2, 'textarea');
                    return false;
                });
            })(jQuery);
        </script>
    </div>
</mt:setvarblock>

<mt:include name="layout/default.tmpl">
<mt:var name="layout">
