!function(t){t.each(["plugin","advanced","core"],function(){tinymce.ScriptLoader.add(tinymce.PluginManager.urls.mt+"/langs/"+this+".js")}),tinymce.Editor.prototype.addMTButton=function(t,e){var n=this,o={},i=e.onclickFunctions;if(i)for(k in e.onclick=function(){var t=n.mtEditorStatus.mode,e=i[t];"string"==typeof e?n.mtProxies[t].execCommand(e):e.apply(n,arguments),"source"==t&&n.onMTSourceButtonClick.dispatch(n,n.controlManager)},i)o[k]=1;else o={wysiwyg:1,source:1};return e.isSupported||(e.isSupported=function(t,e){if(!o[t])return!1;if(i&&"source"==t){var a=i[t];return"string"!=typeof a||n.mtProxies.source.isSupported(a,e)}return!0}),void 0===n.mtButtons&&(n.mtButtons={}),n.mtButtons[t]=e,n.addButton(t,e)},tinymce.create("tinymce.ui.MTTextButton:tinymce.ui.Button",{renderHTML:function(){var t,e,n=tinymce.DOM,o=this.classPrefix,i=this.settings;return e=n.encode(i.label||""),t='<a role="button" id="'+this.id+'" href="javascript:;" class="mceMTTextButton '+o+" "+o+"Enabled "+i.class+(e?" "+o+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" aria-labelledby="'+this.id+'_voice" title="'+n.encode(i.title)+'">',t+=i.text,t+="</a>"}}),tinymce.create("tinymce.plugins.MovableType",{buttonSettings:"",_initButtonSettings:function(e){var n=this;n.buttonIDs={};var o={source:{},wysiwyg:{}},i=1;return t.each(["common","source","wysiwyg"],function(t,a){for(var r="plugin_mt_"+a+"_buttons",s=1;e.settings[r+s];s++)n.buttonSettings+=(n.buttonSettings?",":"")+e.settings[r+s],e.settings["theme_advanced_buttons"+i]=e.theme.settings["theme_advanced_buttons"+i]=e.settings[r+s],"common"==a?o.source[i-1]=o.wysiwyg[i-1]=1:o[a][i-1]=1,i++}),o},_setupIframeStatus:function(e){e.onPostRender.add(function(){var n=t(window),o=t(e.getContainer()).find("iframe"),i=t(e.getWin()),a=".tinymce_mt_iframe_status_"+e.id;i.on("focus",function(){o.addClass("state-focus")}).on("blur",function(){o.removeClass("state-focus")}),function t(){i.on("mousemove"+a,function(){i.off("mousemove"+a),o.addClass("state-hover"),n.on("mousemove"+a,function(){n.off("mousemove"+a),o.removeClass("state-hover"),t()})})}()})},_setupExplicitButtonActivation:function(e){e.onPostRender.add(function(){var n=window,o="$TinyMCEMTButtonActive";t(e.getContainer()).find(".mceButton, .mceListBoxEnabled, .mceSplitButtonEnabled a").on("mousedown",function(){n[o]=t(this).addClass("psedo-active")}),t.each([n.document,e.getWin().document],function(){var e=".tinymce_mt_button_activate",i="mouseup"+e+" touchend"+e;t(this).off(i).on(i,function(){n[o]&&(n[o].removeClass("psedo-active"),n[o]=null)})})})},init:function(e,n){var o=this,i=e.id,a=i.length,r=t("#blog-id").val()||0,s={},c=[],u=null,m=null,l={},d=this._initButtonSettings(e),f={};function _(){var n=e.mtEditorStatus;t.each(c,function(t,n){u.find(".mce_"+n).css({display:""}).removeClass("mce_mt_button_hidden"),e.controlManager.setDisabled(this,!1)}),c=[];var o,r,m,f=(o=n.mode,r=n.format,l[m=o+"-"+r]||(l[m]={},t.each(e.mtButtons,function(t,e){e.isSupported(o,r)&&(l[m][t]=e)})),l[m]);function _(t){f[t]||(u.find(".mce_"+t).css({display:"none"}).addClass("mce_mt_button_hidden"),c.push(t))}"source"==n.mode?(s.source.setFormat(n.format),t.each(e.controlManager.controls,function(t,e){e.classPrefix&&_(t.substr(a+1))})):t.each(e.mtButtons,function(t,e){_(t)}),t("#"+i+"_toolbargroup > span > table").each(function(e){d[n.mode][e]?t(this).show():t(this).hide()})}function p(e,n){createSessionHistoryFallback(location.href),t.fn.mtDialog.open(ScriptURI+"?__mode="+e+"&amp;"+n)}function h(n){t.each(e.windowManager.windows,function(e,o){var i=o.iframeElement;t("#"+i.id).on("load",function(){var e=this.contentWindow,o={$contents:t(this).contents(),window:e};n(o,function(){e.tinyMCEPopup.close(),tinymce.isWebKit&&t("#convert_breaks").trigger("focus"),s.source.focus()})})})}function g(n,o){n.$contents.find("form").attr("onsubmit","").on("submit",function(){var e=t(this);s.source.execCommand("createLink",null,e.find("#href").val(),{target:e.find("#target_list").val(),title:e.find("#linktitle").val()}),o()}),s.source.isSupported("createLink",e.mtEditorStatus.format,"target")||n.$contents.find("#targetlistlabel").closest("tr").hide()}function v(t,n){function o(t,e,n,o,i){"mceInsertContent"==e&&(s.source.editor.insertContent(o),i.terminate=!0)}function i(){e.onBeforeExecCommand.add(o),t.window.TemplateDialog.insert(),e.onBeforeExecCommand.remove(o)}setTimeout(function(){t.$contents.find("form").attr("onsubmit","").on("submit",i)},0)}function y(e,n){t.each(f,function(t,o){n.setActive(t,e.mtProxies.source.isStateActive(o))})}e.mtProxies=s,e.mtEditorStatus={mode:"wysiwyg",format:"richtext"},e.onInit.add(function(){var n,i;u=t(e.getContainer()),_(),t.each(e.mtButtons,function(t,e){var n;e.onclickFunctions&&(n=e.onclickFunctions.source)&&"string"==typeof n&&-1!=o.buttonSettings.indexOf(t)&&(f[t]=n)}),e.theme.resizeBy(0,0),n=e.getWin(),(i=n.document.createElement("META")).setAttribute("http-equiv","Content-Security-Policy"),i.setAttribute("content","script-src 'none'"),n.document.head.appendChild(i)}),e.onPreInit.add(function(){var t=new RegExp("^data-mce-mt-"),n='javascript:void("mce-mt-event-placeholer");return false';e.parser.addAttributeFilter([/^on|action/],function(t,e){var o,i,a="data-mce-mt-"+e;for(o=0;o<t.length;o++)(i=t[o]).attr(a,i.attr(e)),i.attr(e,n)}),e.serializer.addAttributeFilter([t],function(t,e){var o,i,a,r,s=e.substring("data-mce-mt-".length);for(o=0;o<t.length;o++)r=(i=t[o]).attr(s),a=i.attr(e),r===n&&(a&&a.length>0||(a=null),i.attr(s,a)),i.attr(e,null)}),e.parser.addNodeFilter("#comment,#cdata",function(t,e){var n,o;for(n=0;n<t.length;n++)(o=t[n]).value=escape(o.value)}),e.serializer.addNodeFilter("#comment",function(t,e){var n,o;for(n=0;n<t.length;n++)(o=t[n]).value=unescape(o.value),0===o.value.indexOf("[CDATA[")&&(o.name="#cdata",o.type=4,o.value=o.value.replace(/^\[CDATA\[|\]\]$/g,""))}),e.parser.addNodeFilter("link,meta",function(t,e){var n;for(n=0;n<t.length;n++)t[n].remove()})}),e.settings.plugin_mt_tainted_input&&tinymce.isIE&&e.onPreInit.add(function(){var n=new RegExp("^mce-mt-");e.parser.addNodeFilter("link",function(e,n){var o,i;for(o=0;o<e.length;o++)i=e[o],t.each(["type","rel"],function(t,e){var n=i.attr(e);n&&i.attr(e,"mce-mt-"+n)})}),e.parser.addNodeFilter("style",function(t,e){var n,o;for(n=0;n<t.length;n++)(o=t[n]).attr("type","mce-mt-"+(o.attr("type")||"text/css"))}),e.serializer.addNodeFilter("link,style",function(e,o){var i,a;for(i=0;i<e.length;i++)a=e[i],t.each(["type","rel"],function(t,e){var o=a.attr(e);o&&a.attr(e,o.replace(n,""))})}),e.parser.addAttributeFilter("style",function(t,e){var n,o,i="data-mce-mtie-"+e;for(n=0;n<t.length;n++)(o=t[n]).attr(i,o.attr(e)),o.attr(e,"-mt-placeholder:auto;")}),e.serializer.addAttributeFilter("data-mce-mtie-style",function(t,e){var n,o,i,a,r=e.substring("data-mce-mtie-".length);for(n=0;n<t.length;n++)a=(o=t[n]).attr(r),i=o.attr(e),"-mt-placeholder:auto;"===a&&(i&&i.length>0||(i=null),o.attr(r,i)),o.attr(e,null)})}),this._setupExplicitButtonActivation(e),this._setupIframeStatus(e),e.addCommand("mtGetStatus",function(){return e.mtEditorStatus}),e.addCommand("mtSetStatus",function(n){t.extend(e.mtEditorStatus,n),_()}),e.addCommand("mtGetProxies",function(){return s}),e.addCommand("mtSetProxies",function(e){t.extend(s,e)}),e.addCommand("mtRestoreBookmark",function(t){t||(t=m),t&&e.selection.moveToBookmark(m)}),e.addCommand("mtSaveBookmark",function(){return m=e.selection.getBookmark()}),t(window).on("dialogDisposed",function(){m&&e.selection.moveToBookmark(m),m=null}),e.addButton("mt_insert_html",{title:"mt.insert_html",onclick:function(){e.windowManager.open({file:n+"/insert_html.html",width:430,height:345,inline:1},{plugin_url:n})}}),e.addMTButton("mt_insert_image",{title:"mt.insert_image",onclick:function(){e.execCommand("mtSaveBookmark"),p("dialog_asset_modal","_type=asset&amp;edit_field="+i+"&amp;blog_id="+r+"&amp;dialog_view=1&amp;filter=class&amp;filter_val=image&amp;can_multi=1")}}),e.addMTButton("mt_insert_file",{title:"mt.insert_file",onclick:function(){e.execCommand("mtSaveBookmark"),p("dialog_asset_modal","_type=asset&amp;edit_field="+i+"&amp;blog_id="+r+"&amp;dialog_view=1&amp;can_multi=1")}}),e.addMTButton("mt_source_bold",{title:"mt.source_bold",text:"strong",mtButtonClass:"text",onclickFunctions:{source:"bold"}}),e.addMTButton("mt_source_italic",{title:"mt.source_italic",text:"em",mtButtonClass:"text",onclickFunctions:{source:"italic"}}),e.addMTButton("mt_source_blockquote",{title:"mt.source_blockquote",text:"blockquote",mtButtonClass:"text",onclickFunctions:{source:"blockquote"}}),e.addMTButton("mt_source_unordered_list",{title:"mt.source_unordered_list",text:"ul",mtButtonClass:"text",onclickFunctions:{source:"insertUnorderedList"}}),e.addMTButton("mt_source_ordered_list",{title:"mt.source_ordered_list",text:"ol",mtButtonClass:"text",onclickFunctions:{source:"insertOrderedList"}}),e.addMTButton("mt_source_list_item",{title:"mt.source_list_item",text:"li",mtButtonClass:"text",onclickFunctions:{source:"insertListItem"}}),e.addMTButton("mt_source_link",{title:"mt.insert_link",onclickFunctions:{source:function(t,n,o){tinymce._setActive(e),this.theme._mceLink.apply(this.theme),h(g)}}}),e.addMTButton("mt_source_template",{title:"template.desc",onclickFunctions:{source:function(t,n,o){tinymce._setActive(e),e.execCommand("mceTemplate"),h(v)}}}),e.addMTButton("mt_source_mode",{title:"mt.source_mode",onclickFunctions:{wysiwyg:function(){e.execCommand("mtSetFormat","none.tinymce_temp")},source:function(){e.execCommand("mtSetFormat","richtext")}}}),e.onMTSourceButtonClick||(e.onMTSourceButtonClick=new tinymce.util.Dispatcher(e)),e.onMTSourceButtonClick.add(y),e.onNodeChange.add(function(e,n,o,a,r){e.mtEditorStatus;"source"==e.mtEditorStatus.mode&&"none.tinymce_temp"!=e.mtEditorStatus.format?t("#"+i+"_mt_source_mode").css("display","none"):t("#"+i+"_mt_source_mode").css("display","");var s="source"==e.mtEditorStatus.mode&&"none.tinymce_temp"==e.mtEditorStatus.format;n.setActive("mt_source_mode",s),e.mtProxies.source&&y(e,e.controlManager)})},createControl:function(e,n){var o=n.editor.buttons[e];if("mt_insert_image"==e||"mt_insert_file"==e){this.buttonIDs[e]||(this.buttonIDs[e]=[]);var i=e+"_"+this.buttonIDs[e].length;return this.buttonIDs[e].push(i),n.createButton(i,t.extend({},o,{class:"mce_"+e}))}if(o&&o.mtButtonClass){var a,r,s;switch(o.mtButtonClass){case"text":r=tinymce.ui.MTTextButton;break;default:throw new Error("Not implemented:"+o.mtButtonClass)}return n._cls.button&&(s=n._cls.button),n._cls.button=r,a=n.createButton(e,t.extend({},o)),"undefined"!==s&&(n._cls.button=s),a}return null},getInfo:function(){return{longname:"MovableType",author:"Six Apart Ltd",authorurl:"",infourl:"",version:"1.0"}}}),tinymce.PluginManager.add("mt",tinymce.plugins.MovableType)}(jQuery);
