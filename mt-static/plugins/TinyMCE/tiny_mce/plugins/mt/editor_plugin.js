(function(a){a.each(["plugin","advanced"],function(){tinymce.ScriptLoader.add(tinymce.PluginManager.urls.mt+"/langs/"+this+".js")});tinymce.Editor.prototype.addMTButton=function(d,e){var c=this;var f={};var b=e.onclickFunctions;if(b){e.onclick=function(){var h=c.mtEditorStatus.mode;var g=b[h];if(typeof(g)=="string"){c.mtProxies[h].execCommand(g)}else{g.apply(c,arguments)}if(h=="source"){c.onMTSourceButtonClick.dispatch(c,c.controlManager)}};for(k in b){f[k]=1}}else{f={wysiwyg:1,source:1}}if(!e.isSupported){e.isSupported=function(i,h){if(!f[i]){return false}if(b&&i=="source"){var g=b[i];if(typeof(g)=="string"){return c.mtProxies.source.isSupported(g,h)}else{return true}}else{return true}}}if(typeof(c.mtButtons)=="undefined"){c.mtButtons={}}c.mtButtons[d]=e;return c.addButton(d,e)};tinymce.create("tinymce.ui.MTTextButton:tinymce.ui.Button",{renderHTML:function(){var e=tinymce.DOM;var f=this.classPrefix,d=this.settings,c,b;b=e.encode(d.label||"");c='<a role="button" id="'+this.id+'" href="javascript:;" class="mceMTTextButton '+f+" "+f+"Enabled "+d["class"]+(b?" "+f+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" aria-labelledby="'+this.id+'_voice" title="'+e.encode(d.title)+'">';c+=d.text;c+="</a>";return c}});tinymce.create("tinymce.plugins.MovableType",{buttonSettings:"",_initButtonSettings:function(b){var e=this;e.buttonIDs={};var d={source:{},wysiwyg:{}};var c=1;a.each(["common","source","wysiwyg"],function(h,f){var l="plugin_mt_"+f+"_buttons";for(var g=1;b.settings[l+g];g++){e.buttonSettings+=(e.buttonSettings?",":"")+b.settings[l+g];b.settings["theme_advanced_buttons"+c]=b.theme.settings["theme_advanced_buttons"+c]=b.settings[l+g];if(f=="common"){d.source[c-1]=d.wysiwyg[c-1]=1}else{d[f][c-1]=1}c++}});return d},_setupIframeStatus:function(b){b.onPostRender.add(function(){var h=a(window);var d=a(b.getContainer());var g=d.find("iframe");var f=a(b.getWin());var c=".tinymce_mt_iframe_status_"+b.id;f.focus(function(){g.addClass("state-focus")}).blur(function(){g.removeClass("state-focus")});function e(){f.bind("mousemove"+c,function(){f.unbind("mousemove"+c);g.addClass("state-hover");h.bind("mousemove"+c,function(){h.unbind("mousemove"+c);g.removeClass("state-hover");e()})})}e()})},_setupExplicitButtonActivation:function(b){b.onPostRender.add(function(){var f=window;var d="$TinyMCEMTButtonActive";var e=a(b.getContainer());var c=".mceButton, .mceListBoxEnabled, .mceSplitButtonEnabled a";e.find(c).mousedown(function(){f[d]=a(this).addClass("psedo-active")});a.each([f.document,b.getWin().document],function(){var g=this;var h=".tinymce_mt_button_activate";var i="mouseup"+h+" touchend"+h;a(g).unbind(i).bind(i,function(){if(f[d]){f[d].removeClass("psedo-active");f[d]=null}})})})},init:function(h,g){var e=this;var p=h.id;var c=p.length;var r=a("#blog-id").val()||0;var d={};var o=[];var q=null;var v=null;var f={};var u=this._initButtonSettings(h);var l={};h.mtProxies=d;h.mtEditorStatus={mode:"wysiwyg",format:"richtext"};function s(y,x){var w=y+"-"+x;if(!f[w]){f[w]={};a.each(h.mtButtons,function(z,A){if(A.isSupported(y,x)){f[w][z]=A}})}return f[w]}function b(){var w=h.mtEditorStatus;a.each(o,function(A,z){q.find(".mce_"+z).css({display:""}).removeClass("mce_mt_button_hidden");h.controlManager.setDisabled(this,false)});o=[];var x=s(w.mode,w.format);function y(z){if(!x[z]){q.find(".mce_"+z).css({display:"none"}).addClass("mce_mt_button_hidden");o.push(z)}}if(w.mode=="source"){d.source.setFormat(w.format);a.each(h.controlManager.controls,function(z,A){if(!A.classPrefix){return}y(z.substr(c+1))})}else{a.each(h.mtButtons,function(z,A){y(z)})}a("#"+p+"_toolbargroup > span > table").each(function(z){if(u[w.mode][z]){a(this).show()}else{a(this).hide()}})}function t(x,w){a.fn.mtDialog.open(ScriptURI+"?__mode="+x+"&amp;"+w)}function i(w){a.each(h.windowManager.windows,function(y,x){var z=x.iframeElement;a("#"+z.id).load(function(){var B=this.contentWindow;var A={"$contents":a(this).contents(),window:B};w(A,function(){B.tinyMCEPopup.close();if(tinymce.isWebKit){a("#convert_breaks").focus()}d.source.focus()})})})}function n(y,w){function x(){var z=a(this);d.source.execCommand("createLink",null,z.find("#href").val(),{target:z.find("#target_list").val(),title:z.find("#linktitle").val()});w()}y["$contents"].find("form").attr("onsubmit","").submit(x);if(!d.source.isSupported("createLink",h.mtEditorStatus.format,"target")){y["$contents"].find("#targetlistlabel").closest("tr").hide()}}function m(x,w){a.each(h.mtButtons,function(y,z){var A;if(z.onclickFunctions&&(A=z.onclickFunctions["source"])&&(typeof(A)=="string")&&(e.buttonSettings.indexOf(y)!=-1)){l[y]=A}})}function j(x,w){a.each(l,function(y,z){w.setActive(y,x.mtProxies.source.isStateActive(z))})}h.onInit.add(function(){q=a(h.getContainer());b();m();h.theme.resizeBy(0,0)});this._setupExplicitButtonActivation(h);this._setupIframeStatus(h);h.addCommand("mtGetStatus",function(){return h.mtEditorStatus});h.addCommand("mtSetStatus",function(w){a.extend(h.mtEditorStatus,w);b()});h.addCommand("mtGetProxies",function(){return d});h.addCommand("mtSetProxies",function(w){a.extend(d,w)});h.addCommand("mtRestoreBookmark",function(w){if(!w){w=v}if(w){h.selection.moveToBookmark(v)}});h.addCommand("mtSaveBookmark",function(){return v=h.selection.getBookmark()});a(window).bind("dialogDisposed",function(){if(v){h.selection.moveToBookmark(v)}v=null});h.addButton("mt_insert_html",{title:"mt.insert_html",onclick:function(){h.windowManager.open({file:g+"/insert_html.html",width:430,height:335,inline:1},{plugin_url:g})}});h.addMTButton("mt_insert_image",{title:"mt.insert_image",onclick:function(){h.execCommand("mtSaveBookmark");t("dialog_list_asset","_type=asset&amp;edit_field="+p+"&amp;blog_id="+r+"&amp;dialog_view=1&amp;filter=class&amp;filter_val=image")}});h.addMTButton("mt_insert_file",{title:"mt.insert_file",onclick:function(){h.execCommand("mtSaveBookmark");t("dialog_list_asset","_type=asset&amp;edit_field="+p+"&amp;blog_id="+r+"&amp;dialog_view=1")}});h.addMTButton("mt_source_bold",{title:"mt.source_bold",text:"strong",mtButtonClass:"text",onclickFunctions:{source:"bold"}});h.addMTButton("mt_source_italic",{title:"mt.source_italic",text:"em",mtButtonClass:"text",onclickFunctions:{source:"italic"}});h.addMTButton("mt_source_blockquote",{title:"mt.source_blockquote",text:"blockquote",mtButtonClass:"text",onclickFunctions:{source:"blockquote"}});h.addMTButton("mt_source_unordered_list",{title:"mt.source_unordered_list",text:"ul",mtButtonClass:"text",onclickFunctions:{source:"insertUnorderedList"}});h.addMTButton("mt_source_ordered_list",{title:"mt.source_ordered_list",text:"ol",mtButtonClass:"text",onclickFunctions:{source:"insertOrderedList"}});h.addMTButton("mt_source_list_item",{title:"mt.source_list_item",text:"li",mtButtonClass:"text",onclickFunctions:{source:"insertListItem"}});h.addMTButton("mt_source_link",{title:"mt.insert_link",onclickFunctions:{source:function(x,w,y){tinymce._setActive(h);this.theme._mceLink.apply(this.theme);i(n)}}});h.addMTButton("mt_source_mode",{title:"mt.source_mode",onclickFunctions:{wysiwyg:function(){h.execCommand("mtSetFormat","none.tinymce_temp")},source:function(){h.execCommand("mtSetFormat","richtext")}}});if(!h.onMTSourceButtonClick){h.onMTSourceButtonClick=new tinymce.util.Dispatcher(h)}h.onMTSourceButtonClick.add(j);h.onNodeChange.add(function(y,w,C,B,x){var z=y.mtEditorStatus;if(y.mtEditorStatus.mode=="source"&&y.mtEditorStatus.format!="none.tinymce_temp"){a("#"+p+"_mt_source_mode").css("display","none")}else{a("#"+p+"_mt_source_mode").css("display","")}var A=y.mtEditorStatus.mode=="source"&&y.mtEditorStatus.format=="none.tinymce_temp";w.setActive("mt_source_mode",A);if(!y.mtProxies.source){return}j(y,y.controlManager)})},createControl:function(d,b){var g=b.editor;var h=g.buttons[d];if((d=="mt_insert_image")||(d=="mt_insert_file")){if(!this.buttonIDs[d]){this.buttonIDs[d]=[]}var i=d+"_"+this.buttonIDs[d].length;this.buttonIDs[d].push(i);return b.createButton(i,a.extend({},h,{"class":"mce_"+d}))}if(h&&h.mtButtonClass){var f,c,e;switch(h.mtButtonClass){case"text":c=tinymce.ui.MTTextButton;break;default:throw new Error("Not implemented:"+h.mtButtonClass)}if(b._cls.button){e=b._cls.button}b._cls.button=c;f=b.createButton(d,a.extend({},h));if(e!=="undefined"){b._cls.button=e}return f}return null},getInfo:function(){return{longname:"MovableType",author:"Six Apart, Ltd",authorurl:"",infourl:"",version:"1.0"}}});tinymce.PluginManager.add("mt",tinymce.plugins.MovableType)})(jQuery);