!function(a,b){if("object"==typeof exports){var c=require("jquery");module.exports=b(c)}else"function"==typeof define&&define.amd&&define(["jquery"],b)}(0,function(a){!function(a,b){"use strict";var c=b,d={};(a.MT=a.MT||{}).ChartAPI=d;d.Data={};d.Data.getData=function(a,b,d,e){var f,g,h,i;a&&a.done(function(a){f||(f="string"==typeof a?""+a:Array.isArray(a)?c.map(a,function(a){return c.extend({},a)}):c.extend({},a));d(f)}).fail(function(a){g={404:"Data is not found",403:"Data is forbidden to access"};h="Some error occurred in the data fetching process";i=a.status?"error-"+a.status:"error-unknown";e&&(e.$errormsg=c('<div class="error '+i+'">'+(g[a.status]||h)+"</div>").appendTo(b))}).always(function(){e&&e.$progress&&e.$progress.parent().length>0&&e.$progress.remove()}).progress(function(){!e||e.$progress&&0!==e.$progress.parent().length||(e.$progress=c('<div class="progress">fetching data...</div>').appendTo(b))})};d.Data.filterData=function(a,b,e,f,g,h){var i,j={};g=g||1;c.each(a,function(a,k){var l,m;l=d.Date.parse(k.x);if(l&&l>=e&&l<=b)if(h){m=d.Date.createId(l,"daily");j[m]=k}else{"weekly"===f&&(l=d.Date.getWeekStartday(l));m=d.Date.createId(l,f);if(j[m])for(a=0;a<g;a++){i=a?"y"+a:"y";j[m][i]=parseInt(j[m][i],10)+parseInt(k[i],10)}else j[m]=c.extend({},k)}});return j};d.Date={};d.Date.getWeekStartday=function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate()-a.getDay())};d.Date.zeroPadArray=function(a,b){var d;({yearly:function(){d=[a.getFullYear()]},monthly:function(){d=[a.getFullYear(),a.getMonth()+1]},quarter:function(){d=[a.getFullYear(),a.getMonth()+1]},weekly:function(){d=[a.getFullYear(),a.getMonth()+1,a.getDate()-a.getDay()]},daily:function(){d=[a.getFullYear(),a.getMonth()+1,a.getDate()]},hourly:function(){d=[a.getFullYear(),a.getMonth()+1,a.getDate(),a.getHours()]}})[b]();return c.map(d,function(a){a=""+a;return 1===a.length?"0"+a:a})};d.Date.createId=function(a,b){return d.Date.zeroPadArray(a,b).join("")};d.Date.createXLabel=function(a,b){var c,e,f=d.Date.zeroPadArray(a,b);if("hourly"===b){c=f.pop();e=f.join("-")+" "+c+":00"}else e=f.join("-");return e};d.Date.parse=function(a){var b;b=!a||a instanceof Date?a||null:"number"==typeof a?new Date(a):new Date(Date.parse(""+a));if(b&&/NaN|Invalid Date/.test(""+b)){b=a.replace(/-/g,"/").split("+")[0];if(1===b.split("/").length){b=a.match(/([0-9]{4})([0-9]{1,2})([0-9]{1,2})/);b=[b[1],b[2],b[3]].join("/")}2===b.split("/").length&&(b+="/01");b=c.each(b.split("/"),function(a,b){return 1===b.length?"0"+b:b}).join("/");b=new Date(Date.parse(b))}return b};d.Date.calcDate=function(a,b,c,d){var e,f,g,h;e=a.getFullYear();f=a.getMonth();g=a.getDate();h=0;b-=1;d=d?-1:1;({yearly:function(){e+=d*b},monthly:function(){f+=d*b},quarter:function(){f+=d*b*4},weekly:function(){g=g+d*b*7-a.getDay()},daily:function(){g+=d*b},hourly:function(){h=a.getHours()+d*b}})[c]();return new Date(e,f,g,h)};d.Range={};d.Range.factory=function(a){var b;a=a||{};a.maxLength=a.maxLength||90;a.dataType=a.dataType||"timeline";a.isTimeline=d.Range.isTimeline(a.dataType);b=a.isTimeline?d.Range.calcDate:d.Range.calcNum;return b(a.start,a.end,a.length,a.maxLength,a.unit,a.dataType,a.autoSized)};d.Range.generate=d.Range.factory;d.Range.isTimeline=function(a){return!a||"timeline"===a};d.Range.calcDate=function(a,b,e,f,g,h,i){g=g||"monthly";e=e||("hourly"===g?24:10);if(i){var j=c(window).width();f=Math.min(Math.ceil(.021875*j),f);e=f}a=d.Date.parse(a);b=d.Date.parse(b);a||b||(b=d.Range.getEndDate(new Date,g));a||(a=d.Range.getStartDate(d.Date.calcDate(b,e,g,!0),g));b||(b=d.Range.getEndDate(d.Date.calcDate(a,e,g,!1),g));b>new Date&&(b=new Date);a>b&&(a=b);e=d.Range.getLength(a,b,g);if(e>f){e=f;a=d.Date.calcDate(b,e,g,!0)}return{start:a,end:b,length:e,maxLength:f,unit:g,dataType:h,max:d.Range.getEndDate(b,g),min:d.Range.getStartDate(a,g),isTimeline:!0}};d.Range.calcNum=function(a,b,d,e,f,g,h){d=d||10;if(h){var i=c(window).width();e=Math.min(Math.ceil(.021875*i),e);d=Math.min(d,e)}if(!a&&!b){a=0;b=d-1}a=parseInt(a,10)||(0===a?0:null);b=parseInt(b,10)||(0===b?0:null);if(null===a){a=b-d;a<0&&(a=0)}null===b&&(b=a+d);a>b&&(a=b);d=b-a+1;if(d>e){d=e;a=b-e}return{start:a,end:b,length:d,maxLength:e,dataType:g,unit:null,max:b,min:a,isTimeline:!1}};d.Range.getStartDate=function(a,b){var c,d=a.getFullYear(),e=a.getMonth(),f=a.getDate();({yearly:function(){c=new Date(d,0,1,0,0,0)},monthly:function(){c=new Date(d,e,1,0,0,0)},quarter:function(){c=new Date(d,e,1,0,0,0)},weekly:function(){c=new Date(d,e,f-a.getDay(),0,0,0)},daily:function(){c=new Date(d,e,f,0,0,0)},hourly:function(){c=new Date(d,e,f,a.getHours(),0,0)}})[b]();return c};d.Range.getEndDate=function(a,b){var c,d=a.getFullYear(),e=a.getMonth(),f=a.getDate();({yearly:function(){c=new Date(d,11,31,23,59,59)},monthly:function(){c=new Date(new Date(d,e+1,1,0,0,0).valueOf()-1)},quarter:function(){c=new Date(new Date(d,e+1,1,0,0,0).valueOf()-1)},weekly:function(){c=new Date(d,e,f-a.getDay()+6,23,59,59)},daily:function(){c=new Date(d,e,f,23,59,59)},hourly:function(){c=new Date(d,e,f,a.getHours(),0,0)}})[b]();return c<new Date?c:new Date};d.Range.getNextDate=function(a,b,c,d){var e,f=a.getFullYear(),g=a.getMonth(),h=a.getDate();({yearly:function(a){e=new Date(f+a,0,1)},monthly:function(a){e=new Date(f,g+a,1)},quarter:function(a){e=new Date(f,g+4*a,1)},weekly:function(b){e=new Date(f,g,h+7*b-a.getDay())},daily:function(a){e=new Date(f,g,h+a)},hourly:function(b){e=new Date(f,g,h,a.getHours()+b)}})[d](c);return e<b?e:null};d.Range.getDataRange=function(a,b){var e,f,g;if(b){e=c.map(a,function(a){return d.Date.parse(a.x).valueOf()});f=Math.max.apply(null,e);g=Math.min.apply(null,e)}else{g=0;f=a.length-1}return{max:f,min:g}};d.Range.getLength=function(a,b,c){var e;({yearly:function(){e=Math.ceil(b.getFullYear()-a.getFullYear())},monthly:function(){e=Math.ceil(12*b.getFullYear()+b.getMonth()-(12*a.getFullYear()+a.getMonth()))},quarter:function(){e=Math.ceil((12*b.getFullYear()+b.getMonth()-(12*a.getFullYear()+a.getMonth()))/4)},weekly:function(){e=Math.ceil((d.Date.getWeekStartday(b)-d.Date.getWeekStartday(a))/6048e5)},daily:function(){e=Math.ceil((b-a)/864e5)},hourly:function(){e=Math.ceil((b-a)/36e5)}})[c]();return e>0?e+1:1};d.Graph=function(a,c){this.config=b.extend({type:"morris.bar",staticPath:"",data:"graph.json"},a);this.config.id="graph-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config.yLength=parseInt(this.config.yLength,10)||1;this.range=d.Range.generate(c);if("string"==typeof this.config.data)this.origData_=b.getJSON(this.config.staticPath+this.config.data);else{this.origData_=b.Deferred();this.origData_.resolve(this.config.data)}this.graphData={};this.graphData[this.range.unit]=b.Deferred();this.getData(b.proxy(function(a){this.graphData[this.range.unit].resolve(this.generateGraphData(a))},this));this.$graphContainer=b('<div id="'+this.config.id+'-container" class="graph-container">');this.$graphContainer.on("UPDATE",b.proxy(function(a,c,d){this.update_(c,d);return b(this.$graphContainer)},this));this.$graphContainer.on("REMOVE",b.proxy(function(){this.remove_()},this));var e=b(window).width();this.updateFunc=b.proxy(function(){if(e&&e!==b(window).width()){e=b(window).width();this.update_()}},this);a.autoResize&&b(window).on("orientationchange debouncedresize",this.updateFunc);this.$graphContainer.on("GET_DATA_RANGE",b.proxy(function(a,c){b.proxy(this.getData(b.proxy(function(a){c(d.Range.getDataRange(a,this.range.isTimeline))},this),this));return b(this.$graphContainer)},this));this.$graphContainer.on("GET_LABEL",b.proxy(function(a,c,d){b.proxy(this.getData(b.proxy(function(a){d(this.getDataLabelByIndex(c,a))},this),this));return b(this.$graphContainer)},this));this.$graphContainer.on("APPEND_TO",b.proxy(function(a,c){this.$graphContainer.appendTo(c);this.graphData[this.range.unit].done(b.proxy(function(a){var c;c=this.range.isTimeline?b.grep(a,b.proxy(function(a){return this.range.start<=a.timestamp&&a.timestamp<=this.range.end},this)):a.slice(this.range.min,this.range.max+1);this.draw_(c)},this));return b(this.$graphContainer)},this));return this.$graphContainer};d.Graph.prototype.getData=function(a){d.Data.getData(this.origData_,this.$graphContainer,a,this)};d.Graph.prototype.getDataLabelByIndex=function(a,c){var d=this.config.dataLabel||"x";return b.map(a,function(a){return c[a][d]})};d.Graph.prototype.getTotalCount_=function(a,c){var d=0,e="y"+(c||"");b.each(a,function(a,b){d+=parseInt(b[e]||b.value||0,10)});return d};d.Graph.prototype.getDelta_=function(a,b){var c,d,e,f,g=a.length;f="y"+(b||"");c=a[g-1];d=a[g-2];e=d&&c&&d[f]?c[f]-d[f]:c[f];return void 0===e?"":e};d.Graph.presetColors=function(){return["#6AAC2B","#FFBE00","#CF6DD3","#8F2CFF","#2D85FF","#5584D4","#5ED2B8","#9CCF41","#F87085","#2C8087","#8EEC6A","#FFE700","#FF5E19","#FF4040","#976BD6","#503D99","#395595"]};d.Graph.getChartColors=function(a,b){return{reverse:function(a){return a.reverse()},shuffle:function(a){var b,c,d,e;d=a.length;for(b=0;b<d;b++){c=Math.floor(Math.random()*d);e=a[b];a[b]=a[c];a[c]=e}return a},def:function(a){return a}}[b||"def"](a||d.Graph.presetColors())};d.Graph.cachedChartColors={};d.Graph.getCachedChartColors=function(a,b,c){return d.Graph.cachedChartColors[a]=d.Graph.cachedChartColors[a]||d.Graph.getChartColors(b,c)};d.Graph.prototype.draw_=function(a){var c=this.config.type.split("."),e=c[0],f=c[1],g=this.config;if(g.label)if(this.labelTemplate)this.generateLabel(this.labelTemplate);else if(g.label.template){var h=g.label.template;if(window.require&&"function"==typeof require){var i=g.label.type;require([i+"!"+g.staticPath+h],b.proxy(function(a){this.labelTemplate=a;this.generateLabel(a)},this))}else{var j=b.get(g.staticPath+h,"text");d.Data.getData(j,this.$graphContainer,b.proxy(function(a){this.labelTemplate=a;this.generateLabel(a)},this))}}else{this.labelTemplate='<span class="graph-label-label"></span>';this.generateLabel(this.labelTemplate)}if(g.fallback&&g.fallback.test&&!d.Graph.test[g.fallback.test]()){c=g.fallback.type.split(".");e=c[0];f=c[1];g=b.extend(g,g.fallback)}g.chartColors&&"string"==typeof g.chartColors&&(g.chartColors=g.chartColors.split(","));this.graphObject=d.Graph[e][f](a,g,this.range,this.$graphContainer)};d.Graph.test={};d.Graph.test.canvas=function(){var a=document.createElement("canvas");return a.getContext&&a.getContext("2d")};d.Graph.test.svg=function(){var a={svg:"http://www.w3.org/2000/svg"};return!!document.createElementNS&&!!document.createElementNS(a.svg,"svg").createSVGRect};d.Graph.test.vml=function(){var a,b=d.Graph.test.svg();if(!b){var c=document.body.appendChild(document.createElement("div"));c.innerHTML='<v:shape id="vml_flag1" adj="1" />';var e=c.firstChild;e.style.behavior="url(#default#VML)";a=!e||"object"==typeof e.adj;c.parentNode.removeChild(c)}return b||a};d.Graph.prototype.generateLabel=function(a){var c,e=this.config.label.template&&this.config.label.data?this.config.label.data:{},f=this.config.label.yLength||this.config.yLength,g=b.proxy(function(){this.labels=new d.Graph.Labels(this.$graphContainer,f,a);this.getData(b.proxy(function(a){for(var b=0;b<f;b++){this.config.label.hideTotalCount||this.labels.getTotalObject(b).createTotalCount(this.getTotalCount_(a,b));!this.config.label.hideDeltaCount&&this.range.isTimeline&&this.labels.getTotalObject(b).createDeltaCount(this.getDelta_(a,b))}},this))},this);if(e&&"string"==typeof e)c=b.getJSON(this.config.staticPath+e);else{c=b.Deferred();c.resolve(e)}c.done(function(b){if(a&&"function"==typeof a){a=a(b);g()}else if(window._){a=_.template(a,b);g()}else{a=a;g()}})};d.Graph.prototype.update_=function(a,c){var e=this;a=a||[];this.graphObject&&this.graphObject.remove&&this.graphObject.remove();this.labels&&this.labels.remove();this.range=d.Range.generate({start:a[0]||this.range.start,end:a[1]||this.range.end,length:null,maxLength:this.range.maxLength,unit:c||this.range.unit,dataType:this.range.dataType,autoSized:this.range.autoSized});this.graphData[this.range.unit].done(b.proxy(function(a){var c;c=e.range.isTimeline?b.grep(a,b.proxy(function(a){return this.range.min<=a.timestamp&&a.timestamp<=this.range.max},this)):a.slice(this.range.min,this.range.max+1);this.draw_(c)},this))};d.Graph.prototype.remove_=function(){this.config.autoResize&&b(window).off("orientationchange debouncedresize",this.updateFunc);this.graphObject&&this.graphObject.remove&&this.graphObject.remove();this.labels&&this.labels.remove();this.$graphContainer.remove()};d.Graph.prototype.generateGraphData=function(a){var c,e,f,g,h,i,j,k=this.range,l=k.start,m=k.end,n=k.unit,o=k.length,p=[],q=this.config.yLength||1;if(this.range.isTimeline){var r=d.Range.getDataRange(a,this.range.isTimeline);l=new Date(Math.min(this.range.min,r.min));m=new Date(Math.max(this.range.max,r.max));o=d.Range.getLength(l,m,n);h=d.Data.filterData(a,r.max,r.min,n,q);for(c=0;c<o;c++){f=d.Range.getNextDate(l,m,c,n);if(!f)break;g=d.Date.createId(f,n);i={timestamp:f.valueOf(),x:d.Date.createXLabel(f,n)};for(e=0;e<q;e++){j="y"+(e||"");i[j]=h[g]?h[g][j]||0:0}p.push(i)}}else p=a;"morris.donut"===this.config.type&&b.each(p,function(a,c){b.extend(c,{label:c.xLabel||c.x,value:c.y})});return p};d.Graph.Labels=function(a,c,e){var f,g;this.$labelContainer=b('<div class = "graph-labels"></div>');e&&b('<div class="graph-label"></div>').html(e).prependTo(this.$labelContainer);this.totals={};for(f=0;f<c;f++){g="y"+(f||"");this.totals[g]=new d.Graph.Labels.Total(this.$labelContainer,f)}this.$labelContainer.appendTo(a)};d.Graph.Labels.prototype.remove=function(){this.$labelContainer.remove()};d.Graph.Labels.prototype.getTotalObject=function(a){return this.totals["y"+(a||"")]};d.Graph.Labels.Total=function(a,b){this.index=b;this.$totalContainer=c('<div class = "graph-total"></div>').appendTo(a)};d.Graph.Labels.Total.prototype.createTotalCount=function(a){c('<span class="graph-total-count graph-total-count-y"'+(this.index||"")+">"+a+"</span> ").appendTo(this.$totalContainer)};d.Graph.Labels.Total.prototype.createDeltaCount=function(a){var b=a?a<0?"minus ":"plus ":"zero ";c('<span class="graph-delta graph-delta-y"'+(this.index||"")+'><span class="'+b+'">('+a+")</span></span>").appendTo(this.$totalContainer)};d.Graph.css={};d.Graph.css.Base=function(a,c){this.len=a.length;this.$graphEl=b('<div id="'+c.id+'" class="css-graph">')};d.Graph.css.Base.prototype.remove=function(){this.$graphEl.remove()};d.Graph.css.Base.prototype.horizontalBar=function(a,c,e,f){c.width&&this.$graphEl.css({width:c.width,"max-width":"100%",margin:"0 auto"});for(var g,h,i,j,k,l,m=c.barColor||d.Graph.getCachedChartColors(c.id,null,c.chartColorsMethod)[1],n=c.barBackgroundColor||"#f0f0f0",o=c.dateColor||"#999999",p=c.dateColorSaturday||o,q=c.dateColorSunday||o,r=c.labelColor||"#999999",s=parseInt(c.barWidth,10)||30,t=parseInt(c.barMarginLeft,10)||30,u=parseInt(c.barInterval,10)||5,v=parseInt(c.labelSize,10)||.45*s,w=parseInt(c.dateLabelSize,10)||v,x=b.map(a,function(a){return parseInt(a.y,10)}),y=b.map(a,function(a){return{value:""+parseInt(a.x.substr(a.x.lastIndexOf("-")+1),10),weekday:d.Date.parse(a.x)?d.Date.parse(a.x).getDay():null}}),z=Math.max.apply(null,x)||1,A=c.yLabel||x,B=this.len;B>0;){B-=1;g=Math.floor(x[B]/z*100)-15;h=function(){return b('<div class="css-graph-container"><div class="css-graph-date"></div><div class="css-graph-bar-container" style="height:'+s+"px; margin-bottom:"+u+'px"><div class="css-graph-bar"></div><div class="css-graph-bar-background"><div class="css-graph-bar-count"></div></div></div>')}();i=h.find(".css-graph-bar-background");i.css({"background-color":n});if(c.showDate){l=h.find(".css-graph-date");l.text(y[B].value).css({color:o,"font-size":w+"px","line-height":s+"px"});6===y[B].weekday?l.addClass("saturday").css({color:p}):0===y[B].weekday&&l.addClass("sunday").css({color:q});h.find(".css-graph-bar-container").css({"margin-left":t+"px"})}j=h.find(".css-graph-bar");j.css({width:g+"%","background-color":m});k=h.find(".css-graph-bar-count");k.text(A[B]).css({color:r,"font-size":v+"px","line-height":s+"px"});h.appendTo(this.$graphEl)}this.$graphEl.appendTo(f)};d.Graph.css.Base.prototype.ratioHorizontalBar=function(a,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=c.yLength,s=parseInt(c.barWidth,10)||30,t=parseInt(c.barMarginLeft,10)||30,u=parseInt(c.barInterval,10)||5,v=parseInt(c.labelSize,10)||.45*s,w=c.dateColor||"#999999",x=c.barColors||d.Graph.getCachedChartColors(c.id,null,c.chartColorsMethod),y=c.labelColors,z=c.labelClasses;for(g=0;g<this.len;g++){i=a[g];j=[];k=0;q=0;for(h=0;h<r;h++){j.push(i["y"+(h||"")]);k+=parseInt(i["y"+(h||"")],10)}l=b('<div class="css-graph-container"></div>').appendTo(this.$graphEl);if(c.showDate&&i.x){o=""+parseInt(i.x.substr(i.x.lastIndexOf("-")+1),10);b('<div class="css-graph-date" style="color:'+w+";font-size: "+v+"px; line-height:"+s+'px">'+o+"</div>").appendTo(l)}m=b('<div class="css-graph-bar-container" style="height:'+s+"px; margin-bottom:"+u+'px"></div>').appendTo(l);c.showDate&&m.css({"margin-left":t+"px"});for(h=0;h<r;h++){p=Math.floor(j[h]/k*1e3)/10;if(p){r===h&&(p=100-q);q+=p;n=b('<div class="css-graph-y css-graph-y'+(h||"")+'" data-count="'+j[h]+'" style="line-height:'+s+"px; font-size:"+v+'px"></div>');n.css({width:p+"%","background-color":x[h]});c.showCount&&n.text(j[h]);z&&z[h]&&n.addClass(z[h]);y&&y[h]&&n.css({color:y[h]});n.appendTo(m)}}m.appendTo(l)}this.$graphEl.appendTo(f)};d.Graph.css.horizontalBar=d.Graph.css.ratioHorizontalBar=function(a,b,c,e){var f=new d.Graph.css.Base(a,b,c,e);f[b.type.slice(b.type.lastIndexOf(".")+1)](a,b,c,e);return f};d.Graph.easel={};d.Graph.easel.Base=function(a,c,d,e){this.data=a;this.config=c;this.range=d;this.$container=e;if(window.createjs||"function"!=typeof window.require){parseInt(c.width||e.width(),10)?this.buildCanvas(createjs):setTimeout(b.proxy(function(){this.buildCanvas(createjs)},this),100)}else require(["easeljs"],b.proxy(function(){this.buildCanvas(createjs)},this))};d.Graph.easel.Base.prototype.buildCanvas=function(a){this.width=parseInt(this.config.width||this.$container.width(),10)||300;this.height=parseInt(this.config.height||this.$container.height(),10)||300;this.$canvas=b('<canvas id="'+this.config.id+'" class="graph-canvas" width="'+this.width+'" height="'+this.height+'">').appendTo(this.$container);this.canvas=this.$canvas.get(0);this.canvas.getContext("2d");this.stage=this.graph=new a.Stage(this.canvas);this.stage.update();this[this.config.type.split(".")[1]](this.data,this.config)};d.Graph.easel.Base.prototype.remove=function(){this.$canvas.remove()};d.Graph.easel.Base.prototype.bar=function(a,c){for(var e,f,g,h,i,j=a.length,k=c.chartColorsAlpha?c.chartColorsAlpha[0]:1,l=c.chartColors||d.Graph.getCachedChartColors(c.id,null,c.chartColorsMethod),m=this.convertColor(l[0],k),n=parseInt(c.barMargin,10)||10,o=Math.floor(this.width/j),p=o-n,q=Math.floor((this.width-o*j)/2)+n/2,r=b.map(a,function(a){return parseInt(a.y,10)}),s=Math.max.apply(null,r)||1,t=0;t<j;t++){e=new createjs.Shape;f=e.graphics;g=t*o+q;i=Math.floor(r[t]/s*this.height);h=this.height-i;f.beginFill(m).drawRect(g,h,p,i);this.stage.addChild(e)}this.stage.update()};d.Graph.easel.Base.prototype.motionLine=function(a,c){var e,f,g=a.length,h=parseInt(c.lineWidth,10)||8,i=c.yLength||1,j=c.lineColors||c.chartColors||d.Graph.getCachedChartColors(c.id,null,c.chartColorsMethod),k=c.chartColorsAlpha||[null],l=c.pointerColors||c.chartColors||d.Graph.getCachedChartColors(c.id,null,c.chartColorsMethod),m=c.pointerColorsAlpha||[null],n=c.pointerRadius||10,o=h/2,p=h/2,q=2*(g-1),r=Math.floor(this.width/g)/2,s=(this.width-r*q)/2,t=this.height,u=[],v=function(a){return parseInt(a["y"+(w||"")],10)};c.drawPointer&&(p+=n);e=this.height-(o+p);for(var w=0;w<i;w++){f=b.map(a,v);u.push(f)}var x=[];b.each(u,function(a,b){x=x.concat(b)});var y=Math.max.apply(null,x)||1,z=[],A=function(a){var c=[];b.each(a,function(b,d){if(b>0){var f=a[b-1],g=f+Math.floor((d-f)/2);g=Math.floor(g/y*e)+p;d=Math.floor(d/y*e)+p;c=c.concat([g,d])}else{d=Math.floor(d/y*e)+p;c.push(d)}});return c};b.each(u,function(a,b){z.push(A(b))});var B,C,D,E=[],F=[],G=s,H=[];for(w=0;w<i;w++){B=this.convertColor(j[w],k[w]);E[w]=new createjs.Shape;F[w]=E[w].graphics;C=t-z[w][0];F[w].setStrokeStyle(h).beginStroke(B).moveTo(G,C);this.stage.addChild(E[w]);if(c.drawPointer){D=this.convertColor(l[w],m[w]);H[w]=new createjs.Shape;H[w].graphics.beginFill(D).drawCircle(0,0,n);this.stage.addChild(H[w])}}var I=this.stage,J=function(a){q-=1;0===q&&createjs.Ticker.removeEventListener("tick",J);G+=r;for(var b,d=0;d<i;d++){b=z[d];C=t-b[b.length-q-1];F[d].lineTo(G,C);if(c.drawPointer){H[d].x=G;H[d].y=Math.max(C,n)}}I.update(a)};createjs.Ticker.useRAF=!0;createjs.Ticker.setFPS(30);createjs.Ticker.addEventListener("tick",J)};d.Graph.easel.Base.prototype.convertColor=function(a,b){if(-1!==a.indexOf("#")){var c=parseInt(a.substr(1,2),16),d=parseInt(a.substr(3,2),16),e=parseInt(a.substr(5,2),16);a=b?"rgba("+[c,d,e,b].join(",")+")":"rgb("+[c,d,e].join(",")+")"}else-1!==a.indexOf("rgb")&&(a=a.split(",").length<4?"rgb("+a+")":"rgba("+a+")");return a};d.Graph.easel.Base.prototype.mix=function(a,c){var e=0,f=function(a,c){a=a||1;var d=b.map(c,function(b){for(var c,d,f={x:b.x},g=0;g<a;g++){c="y"+(g||"");d="y"+(e+g||"");f[c]=b[d]}return f});e+=a;return d},g=c.chartColors||d.Graph.getCachedChartColors(c.id,null,c.chartColorsMethod);b.each(c.mix,b.proxy(function(d,h){var i={chartColors:g.slice(e,e+h.yLength)},j=f(h.yLength,a);h=b.extend({},c,i,h);this[h.type](j,h)},this))};d.Graph.easel.bar=d.Graph.easel.motionLine=d.Graph.easel.mix=function(a,b,c,e){if(d.Graph.test.canvas()){return new d.Graph.easel.Base(a,b,c,e)}console.warn("EaselJS graph requires for HTML5 Canvas capability");e.trigger("REMOVE")};d.Graph.morris={};d.Graph.morris.Base=function(a,c,d,e){if(window.Morris||"function"!=typeof window.require){c.width||e.width()?this.build_(Morris,a,c,d,e):setTimeout(b.proxy(function(){this.build_(Morris,a,c,d,e)},this),100)}else require(["raphael","morris"],b.proxy(function(){this.build_(Morris,a,c,d,e)},this))};d.Graph.morris.Base.prototype.build_=function(a,c,e,f,g){var h,i,j,k=e.type.split(".")[1],l=e.yLength,m=e.width||g.width()||300,n=e.height||g.height()||300;this.$graphEl=b('<div id="'+e.id+'" class="graph-element"></div>').css({height:n+"px",width:m+"px"}).prependTo(g);e=b.extend({},e,{element:e.id,data:c,xkey:"x",labels:this.getYLabels_(l,e.labels),ykeys:this.getYKeys_(l),ymax:this.getYMax_(c,k,l),ymin:e.ymin||0,lineWidth:parseInt(e.lineWidth,10)||6,pointSize:parseInt(e.pointSize,10)||6,smooth:e.smooth||!1});e.barColors=e.barColors||this.getChartColors(e);e.colors=e.colors||this.getChartColors(e);e.lineColors=e.lineColors||this.getChartColors(e);e.numLines=parseInt(e.numLines,10)||this.getNumLines_(e.ymax,n);e.pointStrokeColors=e.pointStrokeColors?e.pointStrokeColors.split(/,/):[];if(!e.pointStrokeColors.length)for(h=0;h<l;h++)e.pointStrokeColors.push("none");i={element:null,data:null,xkey:"x",labels:[],ykeys:[],dateFormat:null,axes:!0,grid:!0,gridLineColor:"#aaa",gridStrokeWidth:.5,gridTextColor:"#888",gridTextSize:12,hideHover:!1,hoverCallback:null,yLabelFormat:null,numLines:5,padding:25,parseTime:!0,postUnits:"",preUnits:"",ymax:"auto",ymin:"auto 0",goals:[],goalStrokeWidth:1,goalLineColors:["#666633","#999966","#cc6666","#663333"],events:[],eventStrokeWidth:1,eventLineColors:["#005a04","#ccffbb","#3a5f0b","#005502"],lineWidth:3,pointSize:4,lineColors:["#0b62a4","#7A92A3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],pointWidths:[1],pointStrokeColors:["#ffffff"],pointFillColors:[],smooth:!0,xLabels:"auto",xLabelFormat:null,xLabelMargin:50,continuousLine:!0,barSizeRatio:.75,barGap:3,barColors:["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],colors:["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],backgroundColor:"#FFFFFF",labelColor:"#000000",formatter:a.commas};j={};b.each(e,function(a,b){void 0!==i[a]&&(j[a]=b)});d.Graph.test.svg||(j.smooth=!0);if("donut"===k){var o=this.getTotalCount_(c,h);j.formatter=function(a){var b=a=(a+"").replace(/,/g,"");if(!e.noCommaOnYLabel)for(;b!=(b=b.replace(/^(-?\d+)(\d{3})/,"$1,$2")););var c,d=Math.ceil(a/o*1e4)/100;c=e.donutsFormatter&&"function"==typeof e.donutsFormatter?e.donutsFormatter(b,d+"%",a):b+"("+d+"%)";return c}}var p={bar:a.Bar,line:a.Line,donut:a.Donut,area:a.Area}[k];this.graph=new p(j)};d.Graph.morris.Base.prototype.getYMax_=function(a,c,d){var e,f,g,h,i;if("area"!==c){g=[];b.each(a,function(a,b){for(e=0;e<d;e++){i="y"+(e||"");g.push(parseInt(b[i],10))}});f=Math.max.apply(null,g)}else f=Math.max.apply(null,b.map(a,function(a){h=0;for(e=0;e<d;e++){i="y"+(e||"");h+=parseInt(a[i],10)}return h}));f||(f=1);f%2!=0&&(f+=1);return f};d.Graph.morris.Base.prototype.getChartColors=function(a){this.chartColors||(this.chartColors=a.chartColors||d.Graph.getCachedChartColors(a.id,null,a.chartColorsMethod));return this.chartColors};d.Graph.morris.Base.prototype.getYKeys_=function(a){var b,c=[];for(b=0;b<a;b++)c.push("y"+(b||""));return c};d.Graph.morris.Base.prototype.getYLabels_=function(a,b){var c,d=[];b=b?b.split(/,/):[];for(c=0;c<a;c++)d.push(b[c]||"Count");return d};d.Graph.morris.Base.prototype.getNumLines_=function(a,b){var c;c=a>=18?9:2===a?3:a/2+1;c=Math.min(c||1,Math.floor(b/56));return c};d.Graph.morris.Base.prototype.getTotalCount_=function(a,c){var d,e=0,f="y"+(c||"");b.each(a,function(a,b){d=b[f]||b.value||0;"string"==typeof d&&(d=parseFloat(d.replace(/,/g,""),10));e+=d});return e};d.Graph.morris.Base.prototype.remove=function(){this.$graphEl.remove()};d.Graph.morris.bar=d.Graph.morris.line=d.Graph.morris.donut=d.Graph.morris.area=function(a,b,c,e){if(d.Graph.test.vml()){return new d.Graph.morris.Base(a,b,c,e)}console.warn("Morris graph requires for SVG/VML capability");e.trigger("REMOVE")};d.Slider=function(a,c,e,f,g){if(!b.ui||!b.ui.slider)throw"ChartAPI.Slider requied jQuery UI Slider";var h=this;this.id="slider-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config=a;this.range=d.Range.generate(c);this.$dataRangeTarget=e;this.$sliderContainer=b('<div id="'+this.id+'-container" class="slider-container"></div>');this.eventTargetList={update:this.initEventTarget(),amount:this.initEventTarget()};b.each(f,function(a,b){h.eventTargetList.update.add(b)});b.each(g,function(a,b){h.eventTargetList.amount.add(b)});this.$sliderContainer.on("APPEND_TO",function(a,c){h.$container=c;h.draw_(c);return b(this)});this.$sliderContainer.on("BUILD_SLIDER",function(){h.$dataRangeTarget.trigger("GET_DATA_RANGE",function(a){h.buildSlider(a.min,a.max)});return b(this)});this.$sliderContainer.on("SET_DATA_RANGE",function(a,c){h.$dataRangeTarget=c;return b(this)});this.$sliderContainer.on("ADD_EVENT_LIST",function(a,c,d){d=Array.isArray(d)?d:[d];b.each(d,function(a,b){h.eventTargetList[c].add(b)});return b(this)});this.$sliderContainer.on("REMOVE_EVENT_LIST",function(a,c,d){d=Array.isArray(d)?d:[d];b.each(d,function(a,b){h.eventTargetList[c].remove(b)});return b(this)});this.$sliderContainer.on("ERASE",function(){h.erase_();return b(this)});this.$sliderContainer.on("REDRAW",function(){b(this).trigger("BUILD_SLIDER").trigger("APPEND_TO",[h.$container]);return b(this)});this.$sliderContainer.on("UPDATE",function(a,c){h.$slider("values",c);h.updateSliderAmount(c);return b(this)});return this.$sliderContainer};d.Slider.prototype.initEventTarget=function(){var a=[];return{add:function(b){a.push(b)},remove:function(c){a=b.grep(a,function(a){return a!==c})},get:function(){return a}}};d.Slider.prototype.buildSlider=function(a,c,d){var e=this;d=d||[this.range.min,this.range.max];if(this.$slider){this.$slider.destroy();this.$slider.remove()}this.$slider=b('<div class="slider"></div>').slider({range:!0,min:a,max:c,values:d,slide:function(a,b){e.updateSliderAmount(b.values,b)},stop:function(a,b){e.updateGraphAndList(b.values)}}).appendTo(e.$sliderContainer);if(!this.config.hideSliderAmount){this.$amount=b('<div class="amount"></div>');this.config.appendSliderAmountBottom?this.$amount.appendTo(this.$sliderContainer):this.$amount.prependTo(this.$sliderContainer);this.updateSliderAmount(d)}};d.Slider.prototype.draw_=function(a){this.$sliderContainer.appendTo(a)};d.Slider.prototype.erase_=function(){this.$slider&&this.$slider.destroy();this.$sliderContainer.html("")};d.Slider.prototype.updateSliderAmount=function(a,c){var e,f,g,h,i=this.range.maxLength,j=this.$amount;if(this.range.isTimeline){e=d.Date.parse(a[0]);f=d.Date.parse(a[1]);g=this.range.unit;h=d.Range.getLength(e,f,g);if(c&&h>i)if(c.value===c.values[0]){f=d.Date.calcDate(e,i,g,!1);this.$slider.slider("values",1,f.valueOf())}else{e=d.Date.calcDate(f,i,g,!0);this.$slider.slider("values",0,e.valueOf())}j&&j.text([d.Date.createXLabel(e,g),d.Date.createXLabel(f,g)].join(" - "))}else{e=a[0];f=a[1];if(f-e>i)if(c.value===c.values[0]){f=i-e;this.$slider.slider("values",1,f)}else{e=f-i;this.$slider.slider("values",0,e)}j&&b.each(this.eventTargetList.amount.get(),function(a,b){b.trigger("GET_LABEL",[[e,f],function(a){j.text([a[0],a[1]].join(" - "))}])})}};d.Slider.prototype.updateGraphAndList=function(a,c){b.each(this.eventTargetList.update.get(),function(b,d){d.trigger("UPDATE",[a,c])})};d.Slider.prototype.update_=function(a,b){this.$slider.slider("values",a,b)};d.List=function(a,c){this.id="list-"+(new Date).valueOf()+Math.floor(100*Math.random());this.config=a;this.config.staticPath=this.config.staticPath||"";if(this.config.data&&"string"==typeof this.config.data)this.origData_=b.getJSON(this.config.staticPath+this.config.data);else{this.origData_=b.Deferred();this.origData_.resolve(this.config.data)}if(this.config.template){if(window.require&&"function"==typeof require){var e=this.config.type||"text";this.template_=b.Deferred();require([e+"!"+this.config.staticPath+this.config.template],b.proxy(function(a){this.template_.resolve(a)},this))}else this.template_=b.get(this.config.staticPath+this.config.template,"text");this.range=d.Range.generate(c);this.$listContainer=b('<div id="'+this.id+'-container" class="list-container"></div>');this.$listContainer.on("UPDATE",b.proxy(function(a,b){this.update_(b)},this));this.$listContainer.on("GET_DATA_RANGE",b.proxy(function(a,c){this.getData(b.proxy(function(a){c(d.Range.getDataRange(a,this.range.isTimeline))},this));return this.$listContainer},this));this.$listContainer.on("GET_LABEL",b.proxy(function(a,c,d){this.getData(b.proxy(function(a){d(this.getDataLabelByIndex(c,a))},this));return this.$listContainer},this));this.$listContainer.on("APPEND_TO",b.proxy(function(a,c){this.$listContainer.appendTo(c);this.getData(b.proxy(function(a){this.draw_(a)},this));return this.$listContainer},this));return this.$listContainer}};d.List.prototype.getData=function(a){this.config.data?d.Data.getData(this.origData_,this.$listContainer,a,this):a()};d.List.prototype.getTemplate=function(a){d.Data.getData(this.template_,this.$listContainer,a,this)};d.List.prototype.draw_=function(a){var b=this;this.getTemplate(function(c){a=b.createListData(a);b.$listContainer.html(_.template(c,a))})};d.List.prototype.getDataLabelByIndex=function(a,c){var d=this.config.dataLabel||"x";return b.map(a,function(a){return c[a][d]})};d.List.prototype.createListData=function(a){var b="";a&&(b=this.range.isTimeline?d.Data.filterData(a,this.range.max,this.range.min,this.range.unit,1,!0):a.slice(this.range.min,this.range.max+1));return{data:b}};d.List.prototype.update_=function(a,b){var c=this;a=a||[];b=b||this.range.unit;this.range=d.Range.generate({start:a[0]||this.range.start,end:a[1]||this.range.end,length:null,maxLength:this.range.maxLength,unit:b,dataType:this.range.dataType});this.getData(function(a){c.draw_(a)})};d.Build=function(a){var c;if("string"==typeof a&&/\.json$/.test(a)){c=b('<div class="mtchart-container">');d.Data.getData(b.getJSON(a),null,function(a){a.$container=c;d.Build_(a).trigger("APPEND")})}else c=d.Build_(a).trigger("APPEND");return c};d.Build_=function(a){var c,e,f,g,h,i,j;c=a.$container||b('<div class="mtchart-container">');i=[];if(a.graph){
e=new d.Graph(a.graph,a.range);i.push(e)}if(a.list){g=new d.List(a.list,a.range);a.list.data&&i.push(g)}if(a.graph&&"donut"!==a.graph.type){h=e;j=[e]}else{h=g;j=[g]}!a.slider||!a.slider.force&&function(){return/android|iphone|ipod|ipad/i.test(window.navigator?window.navigator.userAgent:"")}()||(f=new d.Slider(a.slider,a.range,h,i,j));c.on("APPEND",function(){e&&e.trigger("APPEND_TO",[c]);f&&f.trigger("BUILD_SLIDER").trigger("APPEND_TO",[c]);g&&g.trigger("APPEND_TO",[c])});c.on("GET_CONTAINER",function(a,b,c){c({graph:e,slider:f,list:g}[b])});return c}}(this,jQuery);return MT.ChartAPI});