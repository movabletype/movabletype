/*!
 * jQuery.selection - jQuery Plugin
 *
 * Copyright (c) 2010-2014 IWASAKI Koji (@madapaja).
 * http://blog.madapaja.net/
 * Under The MIT License
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(e,t,r){var n=function(e){var n={text:"",start:0,end:0};if(!e.value){return n}try{if(t.getSelection){n.start=e.selectionStart;n.end=e.selectionEnd;n.text=e.value.slice(n.start,n.end)}else if(r.selection){e.focus();var s=r.selection.createRange(),a=r.body.createTextRange();n.text=s.text;try{a.moveToElementText(e);a.setEndPoint("StartToStart",s)}catch(c){a=e.createTextRange();a.setEndPoint("StartToStart",s)}n.start=e.value.length-a.text.length;n.end=n.start+s.text.length}}catch(c){}return n};var s={getPos:function(e){var t=n(e);return{start:t.start,end:t.end}},setPos:function(e,r,n){n=this._caretMode(n);if(n==="start"){r.end=r.start}else if(n==="end"){r.start=r.end}e.focus();try{if(e.createTextRange){var s=e.createTextRange();if(t.navigator.userAgent.toLowerCase().indexOf("msie")>=0){r.start=e.value.substr(0,r.start).replace(/\r/g,"").length;r.end=e.value.substr(0,r.end).replace(/\r/g,"").length}s.collapse(true);s.moveStart("character",r.start);s.moveEnd("character",r.end-r.start);s.select()}else if(e.setSelectionRange){e.setSelectionRange(r.start,r.end)}}catch(a){}},getText:function(e){return n(e).text},_caretMode:function(e){e=e||"keep";if(e===false){e="end"}switch(e){case"keep":case"start":case"end":break;default:e="keep"}return e},replace:function(t,r,s){var a=n(t),c=t.value,o=e(t).scrollTop(),i={start:a.start,end:a.start+r.length};t.value=c.substr(0,a.start)+r+c.substr(a.end);e(t).scrollTop(o);this.setPos(t,i,s)},insertBefore:function(t,r,s){var a=n(t),c=t.value,o=e(t).scrollTop(),i={start:a.start+r.length,end:a.end+r.length};t.value=c.substr(0,a.start)+r+c.substr(a.start);e(t).scrollTop(o);this.setPos(t,i,s)},insertAfter:function(t,r,s){var a=n(t),c=t.value,o=e(t).scrollTop(),i={start:a.start,end:a.end};t.value=c.substr(0,a.end)+r+c.substr(a.end);e(t).scrollTop(o);this.setPos(t,i,s)}};e.extend({selection:function(n){var s=(n||"text").toLowerCase()==="text";try{if(t.getSelection){if(s){return t.getSelection().toString()}else{var a=t.getSelection(),c;if(a.getRangeAt){c=a.getRangeAt(0)}else{c=r.createRange();c.setStart(a.anchorNode,a.anchorOffset);c.setEnd(a.focusNode,a.focusOffset)}return e("<div></div>").append(c.cloneContents()).html()}}else if(r.selection){if(s){return r.selection.createRange().text}else{return r.selection.createRange().htmlText}}}catch(o){}return""}});e.fn.extend({selection:function(e,t){t=t||{};switch(e){case"getPos":return s.getPos(this[0]);case"setPos":return this.each(function(){s.setPos(this,t)});case"replace":return this.each(function(){s.replace(this,t.text,t.caret)});case"insert":return this.each(function(){if(t.mode==="before"){s.insertBefore(this,t.text,t.caret)}else{s.insertAfter(this,t.text,t.caret)}});case"get":default:return s.getText(this[0])}return this}})})(jQuery,window,window.document);
